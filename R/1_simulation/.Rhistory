ae_raw <- st_read('~/Documents/GitHub/OptimSS/data/aedes_raw.geojson')
mos <- ae_raw
### Hyperparameters
prior_range <- 1000
### model fit
mesh <- fm_mesh_2d(mos, max.edge = c(2500, 5000), cutoff = 1000)
View(mos)
class(mos)
roi <- st_read('~/Documents/GitHub/OptimSS/data/ROI_32650.geojson')
### model fit
mesh <- fm_mesh_2d(roi, max.edge = c(2500, 5000), cutoff = 1000)
matern <- inla.spde2.pcmatern(mesh, alpha = 2,
prior.sigma = c(0.5, 0.01), prior.range = c(prior_range, 0.1))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon, control.group = list(model = 'ar1'))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log")
))
summary(fit)
fit$summary.random$land_cover
mos <- an_raw
### Hyperparameters
prior_range <- 3000
### model fit
mesh <- fm_mesh_2d(roi, max.edge = c(2500, 5000), cutoff = 1000)
matern <- inla.spde2.pcmatern(mesh, alpha = 2,
prior.sigma = c(0.5, 0.01), prior.range = c(prior_range, 0.1))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon, control.group = list(model = 'ar1'))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log")
))
fit$summary.random$land_cover
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
fit$summary.random$land_cover
prec_prior <- list(prec = list(param = c(0.9, 0.95)))
rho <- list(theta=list(prior='normal', param=c(0, 0.95)))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon, control.group = list(model = 'ar1', hyper = rho))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
summary(fit)
rho <- list(theta=list(prior='normal', param=c(0.95, 0.001)))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon, control.group = list(model = 'ar1', hyper = rho))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
summary(fit)
fit$summary.random$land_cover
rho <- list(theta=list(prior='normal', param=c(0.935, 0.0001)))
matern <- inla.spde2.pcmatern(mesh, alpha = 2,
prior.sigma = c(0.5, 0.01), prior.range = c(prior_range, 0.1))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon, control.group = list(model = 'ar1', hyper = rho))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
summary(fit)
fit$summary.random$land_cover
rho <- list(theta=list(prior='normal', param=c(0.935, 0.1)))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon, control.group = list(model = 'ar1', hyper = rho))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
summary(fit)
fit$summary.random$land_cover
mos <- ae_raw
### Hyperparameters
prior_range <- 1000
rho <- list(theta=list(prior='normal', param=c(0.9, 0.1)))
### model fit
mesh <- fm_mesh_2d(roi, max.edge = c(2500, 5000), cutoff = 1000)
matern <- inla.spde2.pcmatern(mesh, alpha = 2,
prior.sigma = c(0.5, 0.01), prior.range = c(prior_range, 0.1))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon, control.group = list(model = 'ar1', hyper = rho))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
View(ae_raw)
summary(fit)
fit$summary.random$land_cover
### Hyperparameters
prior_range <- 1000
rho <- 0.9
### model fit
mesh <- fm_mesh_2d(roi, max.edge = c(2500, 5000), cutoff = 1000)
matern <- inla.spde2.pcmatern(mesh, alpha = 2,
prior.sigma = c(0.5, 0.01), prior.range = c(prior_range, 0.1))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon,
control.group = list(model = 'ar1',
hyper = list(theta=list(prior='p.cor1', param=c(rho, 0.1))) ))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon,
control.group = list(model = 'ar1',
hyper = list(theta=list(prior='pc.cor1', param=c(rho, 0.1))) ))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon,
control.group = list(model = 'ar1',
hyper = list(theta=list(prior='normal', param=c(rho, 0.1))) ))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
summary(fit)
### Hyperparameters
range <- 1000
matern <- inla.spde2.pcmatern(mesh, alpha = 2,
prior.sigma = c(0.5, 0.01), prior.range = c(range, 0.1))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon,
control.group = list(model = 'ar1',
hyper = list(theta=list(prior='pc.cor0', param=c(rho, 0.1))) ))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
summary(fit)
mesh <- fm_mesh_2d(roi, max.edge = c(2500, 5000), cutoff = 1000)
matern <- inla.spde2.pcmatern(mesh, alpha = 2,
prior.sigma = c(0.5, 0.01), prior.range = c(range, 0.1))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon,
control.group = list(model = 'ar1',
hyper = list(theta=list(prior='normal', param=c(rho, 0.1))) ))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
View(ae_raw)
range <- 1000
rho <- 0.9
### model fit
mesh <- fm_mesh_2d(roi, max.edge = c(2500, 5000), cutoff = 1000)
matern <- inla.spde2.pcmatern(mesh, alpha = 2,
prior.sigma = c(0.5, 0.01), prior.range = c(range, 0.1))
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon,
control.group = list(model = 'ar1',
hyper = list(theta=list(prior='normal', param=c(rho, 0.1))) ))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
View(ae_raw)
summary(fit)
model <- bite_rate ~ Intercept(1) +
land_cover(Class, model = 'factor_contrast') +
field(geometry, model = matern, group = mon,
control.group = list(model = 'ar1',
hyper = list(theta=list(prior='normal', param=c(rho, 0.001))) ))
fit <- bru(model, mos, family = "nbinomial",
options = list(control.family = list(link = "log"),
control.inla = list(int.strategy = "eb")
))
summary(fit)
fit$summary.random$land_cover
### Load and install required packages
packs <- c("sf", "terra", "tidyverse", "ggridges", "tidyterra", "stars", "raster", "INLA", "inlabru", "fmesher")
success <- suppressWarnings(sapply(packs, require, character.only = TRUE))
install.packages(names(success)[!success])
sapply(names(success)[!success], require, character.only = TRUE)
source("./helpers/mosquito_class.R")
source("./helpers/mosquito_class.R")
source("./helpers/extract_values.R")
packs <- c("sf", "terra", "tidyverse", "ggridges", "tidyterra", "stars", "raster", "INLA", "inlabru", "fmesher")
success <- suppressWarnings(sapply(packs, require, character.only = TRUE))
install.packages(names(success)[!success])
sapply(names(success)[!success], require, character.only = TRUE)
source("./helpers/mosquito_class.R")
source("./helpers/extract_values.R")
# Land cover
landcover <- rast('~/Documents/GitHub/OptimSS/data/aligned_landcover.tif')
# Land cover
landcover <- rast('~/Documents/GitHub/OptimSS/data/aligned_landcover.tif')
beta <- c(0.7351552, 2.588883, 1.775618, 1.612111, 1.156367) # Primary, Secondary, Oil Palm, Plantation, Built-up
range <- 3000
rho <- 0.9353888
phi <- 10
anopheles <- Mosquito(lc_coefficients = beta,
spatial_range = range,
rho = rho,
phi = phi,
land_cover = landcover,
seed = 1234)
boundary <- st_read('~/Documents/GitHub/OptimSS/data/ROI_32650.geojson')
anopheles <- Mosquito(lc_coefficients = beta,
spatial_range = range,
rho = rho,
phi = phi,
land_cover = landcover,
seed = 1234)
plot(anopheles@simulated_surface)
anopheles <- Mosquito(boundary = roi,
lc_coefficients = beta,
spatial_range = range,
rho = rho,
phi = phi,
land_cover = landcover,
seed = 1234)
source("./helpers/mosquito_class.R")
anopheles <- Mosquito(boundary = roi,
lc_coefficients = beta,
spatial_range = range,
rho = rho,
phi = phi,
land_cover = landcover,
seed = 1234)
packs <- c("sf", "terra", "tidyverse", "ggridges", "tidyterra", "stars", "raster", "INLA", "inlabru", "fmesher")
success <- suppressWarnings(sapply(packs, require, character.only = TRUE))
install.packages(names(success)[!success])
sapply(names(success)[!success], require, character.only = TRUE)
source("./helpers/mosquito_class.R")
source("./helpers/extract_values.R")
boundary <- st_read('~/Documents/GitHub/OptimSS/data/ROI_32650.geojson')
# Land cover
landcover <- rast('~/Documents/GitHub/OptimSS/data/aligned_landcover.tif')
beta <- c(0.7351552, 2.588883, 1.775618, 1.612111, 1.156367) # Primary, Secondary, Oil Palm, Plantation, Built-up
range <- 3000
rho <- 0.9353888
phi <- 10
anopheles <- Mosquito(boundary = roi,
lc_coefficients = beta,
spatial_range = range,
rho = rho,
phi = phi,
land_cover = landcover,
seed = 1234)
source("./helpers/mosquito_class.R")
roi <- st_read('~/Documents/GitHub/OptimSS/data/ROI_32650.geojson')
anopheles <- Mosquito(boundary = roi,
lc_coefficients = beta,
spatial_range = range,
rho = rho,
phi = phi,
land_cover = landcover,
seed = 1234)
source("./helpers/mosquito_class.R")
anopheles <- Mosquito(boundary = roi,
lc_coefficients = beta,
spatial_range = range,
rho = rho,
phi = phi,
land_cover = landcover,
seed = 1234)
plot(anopheles@simulated_surface)
##############
##############
##############
# iterations = 100
generate_sampling_scenarios <- function(roi,
iterations = 1,
sample_sizes = c(300, 1000),
models = c('a','b','c','d','e','f','g','h','i'),
crs = 32650) {
samples <- list()
grids <- list()
for (m in seq_along(models)) {
model_s_temp <- list()
model_g_temp <- list()
for (n in seq_along(sample_sizes)) {
samples_temp <- list()
grids_temp <- list()
for (i in seq_len(iterations)) {
if (m == 1) {
temp <- uniform_sample(roi, sample_size = sample_sizes[n], fixed = TRUE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 2) {
temp <- stratified_sample(roi, sample_size = sample_sizes[n], fixed = TRUE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 3) {
temp <- random_sample(roi, sample_size = sample_sizes[n], fixed = TRUE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 4) {
ss1 <- round(sample_sizes[n] / 2)
ss2 <- sample_sizes[n] - ss1
temp1 <- random_sample(roi, sample_size = ss1, fixed = TRUE)
temp2 <- uniform_sample(roi, sample_size = ss2, fixed = FALSE)
s1 <- st_as_sf(temp1[[1]], coords = c('x', 'y'), crs = crs)
s2 <- st_as_sf(temp2[[1]], coords = c('x', 'y'), crs = crs)
s <- rbind(s1, s2)
g1 <- temp1[[2]]
g2 <- temp2[[2]]
g <- rbind(g1, g2)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 5) {
ss1 <- round(sample_sizes[n] / 2)
ss2 <- sample_sizes[n] - ss1
temp1 <- random_sample(roi, sample_size = ss1, fixed = TRUE)
temp2 <- stratified_sample(roi, sample_size = ss2, fixed = FALSE)
s1 <- st_as_sf(temp1[[1]], coords = c('x', 'y'), crs = crs)
s2 <- st_as_sf(temp2[[1]], coords = c('x', 'y'), crs = crs)
s <- rbind(s1, s2)
g1 <- temp1[[2]]
g2 <- temp2[[2]]
g <- rbind(g1, g2)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 6) {
ss1 <- round(sample_sizes[n] / 2)
ss2 <- sample_sizes[n] - ss1
temp1 <- random_sample(roi, sample_size = ss1, fixed = TRUE)
temp2 <- random_sample(roi, sample_size = ss2, fixed = FALSE)
s1 <- st_as_sf(temp1[[1]], coords = c('x', 'y'), crs = crs)
s2 <- st_as_sf(temp2[[1]], coords = c('x', 'y'), crs = crs)
s <- rbind(s1, s2)
g1 <- temp1[[2]]
g2 <- temp2[[2]]
g <- rbind(g1, g2)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 7) {
temp <- uniform_sample(roi, sample_size = sample_sizes[n], fixed = FALSE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 8) {
temp <- stratified_sample(roi, sample_size = sample_sizes[n], fixed = FALSE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 9) {
temp <- random_sample(roi, sample_size = sample_sizes[n], fixed = FALSE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else {
next
}
if (!exists("s")) {
s <- st_as_sf(temp[[1]], coords = c('x', 'y'), crs = crs)
g <- temp[[2]]
}
s$iteration <- i
g$iteration <- i
s$sample_size <- sample_sizes[n]
g$sample_size <- sample_sizes[n]
s$scenario <- models[m]
g$scenario <- models[m]
samples_temp[[i]] <- s
grids_temp[[i]] <- g
rm(s)
rm(g)
} # end iterations
model_s_temp[[n]] <- do.call(rbind, samples_temp)
model_g_temp[[n]] <- do.call(rbind, grids_temp)
} # end sample_sizes
samples[[m]] <- do.call(rbind, model_s_temp)
grids[[m]] <- do.call(rbind, model_g_temp)
} # end models
samples <- do.call(rbind, samples)
grids <- do.call(rbind, grids)
grids <- grids[, c('id', 'cat', 'month', 'iteration', 'sample_size', 'scenario', 'geometry')]
return(list(samples = samples, grids = grids))
}
##############
##############
##############
# iterations = 100
generate_sampling_scenarios <- function(roi,
iterations = 1,
sample_sizes = c(5, 10),
models = c('a','b','c','d','e','f','g','h','i'),
crs = 32650) {
samples <- list()
grids <- list()
for (m in seq_along(models)) {
model_s_temp <- list()
model_g_temp <- list()
for (n in seq_along(sample_sizes)) {
samples_temp <- list()
grids_temp <- list()
for (i in seq_len(iterations)) {
if (m == 1) {
temp <- uniform_sample(roi, sample_size = sample_sizes[n], fixed = TRUE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 2) {
temp <- stratified_sample(roi, sample_size = sample_sizes[n], fixed = TRUE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 3) {
temp <- random_sample(roi, sample_size = sample_sizes[n], fixed = TRUE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 4) {
ss1 <- round(sample_sizes[n] / 2)
ss2 <- sample_sizes[n] - ss1
temp1 <- random_sample(roi, sample_size = ss1, fixed = TRUE)
temp2 <- uniform_sample(roi, sample_size = ss2, fixed = FALSE)
s1 <- st_as_sf(temp1[[1]], coords = c('x', 'y'), crs = crs)
s2 <- st_as_sf(temp2[[1]], coords = c('x', 'y'), crs = crs)
s <- rbind(s1, s2)
g1 <- temp1[[2]]
g2 <- temp2[[2]]
g <- rbind(g1, g2)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 5) {
ss1 <- round(sample_sizes[n] / 2)
ss2 <- sample_sizes[n] - ss1
temp1 <- random_sample(roi, sample_size = ss1, fixed = TRUE)
temp2 <- stratified_sample(roi, sample_size = ss2, fixed = FALSE)
s1 <- st_as_sf(temp1[[1]], coords = c('x', 'y'), crs = crs)
s2 <- st_as_sf(temp2[[1]], coords = c('x', 'y'), crs = crs)
s <- rbind(s1, s2)
g1 <- temp1[[2]]
g2 <- temp2[[2]]
g <- rbind(g1, g2)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 6) {
ss1 <- round(sample_sizes[n] / 2)
ss2 <- sample_sizes[n] - ss1
temp1 <- random_sample(roi, sample_size = ss1, fixed = TRUE)
temp2 <- random_sample(roi, sample_size = ss2, fixed = FALSE)
s1 <- st_as_sf(temp1[[1]], coords = c('x', 'y'), crs = crs)
s2 <- st_as_sf(temp2[[1]], coords = c('x', 'y'), crs = crs)
s <- rbind(s1, s2)
g1 <- temp1[[2]]
g2 <- temp2[[2]]
g <- rbind(g1, g2)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 7) {
temp <- uniform_sample(roi, sample_size = sample_sizes[n], fixed = FALSE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 8) {
temp <- stratified_sample(roi, sample_size = sample_sizes[n], fixed = FALSE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else if (m == 9) {
temp <- random_sample(roi, sample_size = sample_sizes[n], fixed = FALSE)
print(paste0('Model: ', models[m], ' - ', 'Sample size: ', sample_sizes[n], ' - ', 'Iteration: ', i))
} else {
next
}
if (!exists("s")) {
s <- st_as_sf(temp[[1]], coords = c('x', 'y'), crs = crs)
g <- temp[[2]]
}
s$iteration <- i
g$iteration <- i
s$sample_size <- sample_sizes[n]
g$sample_size <- sample_sizes[n]
s$scenario <- models[m]
g$scenario <- models[m]
samples_temp[[i]] <- s
grids_temp[[i]] <- g
rm(s)
rm(g)
} # end iterations
model_s_temp[[n]] <- do.call(rbind, samples_temp)
model_g_temp[[n]] <- do.call(rbind, grids_temp)
} # end sample_sizes
samples[[m]] <- do.call(rbind, model_s_temp)
grids[[m]] <- do.call(rbind, model_g_temp)
} # end models
samples <- do.call(rbind, samples)
grids <- do.call(rbind, grids)
grids <- grids[, c('id', 'cat', 'month', 'iteration', 'sample_size', 'scenario', 'geometry')]
return(list(samples = samples, grids = grids))
}
# call the function and assign outputs to the expected variables
res <- generate_sampling_scenarios(roi,
iterations = 1,
sample_sizes = c(5, 10),
models = c('a','b','c'),
crs = 32650)
source('~/Documents/GitHub/OptimSS/R/2_sampling/helpers/sampling_functions.R')
# call the function and assign outputs to the expected variables
res <- generate_sampling_scenarios(roi,
iterations = 1,
sample_sizes = c(5, 10),
models = c('a','b','c'),
crs = 32650)
samples <- res$samples
grids <- res$grids
View(samples)
packs <- c("sf", "tidyverse")
success <- suppressWarnings(sapply(packs, require, character.only = TRUE))
install.packages(names(success)[!success])
sapply(names(success)[!success], require, character.only = TRUE)
source('~/Documents/GitHub/OptimSS/R/2_sampling/helpers/sampling_scenarios.R')
roi <- st_read('~/Documents/GitHub/OptimSS/data/1_raw/ROI_32650.geojson')
res <- generate_sampling_scenarios(roi,
iterations = 1,
sample_sizes = c(5, 10),
models = c('a','b','c'),
crs = 32650)
samples <- res$samples
grids <- res$grids
simulation <- rast('~/Documents/GitHub/OptimSS/data/2_simulation/20250331_sim_raster001.tif')
View(simulation)
plot(simulation)
